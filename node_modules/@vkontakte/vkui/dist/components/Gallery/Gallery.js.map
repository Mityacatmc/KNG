{"version":3,"sources":["../../../src/components/Gallery/Gallery.tsx"],"sourcesContent":["import * as React from 'react';\nimport { clamp } from '../../helpers/math';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { BaseGallery } from '../BaseGallery/BaseGallery';\nimport { BaseGalleryProps } from '../BaseGallery/types';\n\nexport interface GalleryProps extends BaseGalleryProps {\n  initialSlideIndex?: number;\n  timeout?: number;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  ...props\n}: GalleryProps) => {\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === 'number';\n  const slideIndex = isControlled ? props.slideIndex ?? 0 : localSlideIndex;\n  const isDraggable = !isControlled || Boolean(onChange);\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children],\n  );\n  const childCount = slides.length;\n\n  const handleChange: GalleryProps['onChange'] = React.useCallback(\n    (current: number) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex],\n  );\n\n  const autoplay = useTimeout(() => handleChange((slideIndex + 1) % childCount), timeout);\n  React.useEffect(\n    () => (timeout ? autoplay.set() : autoplay.clear()),\n    [timeout, slideIndex, autoplay],\n  );\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  return (\n    <BaseGallery\n      isDraggable={isDraggable}\n      {...props}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </BaseGallery>\n  );\n};\n"],"names":["React","clamp","useTimeout","BaseGallery","Gallery","initialSlideIndex","children","timeout","onChange","bullets","props","useState","localSlideIndex","setSlideIndex","isControlled","slideIndex","isDraggable","Boolean","slides","useMemo","Children","toArray","filter","item","childCount","length","handleChange","useCallback","current","autoplay","useEffect","set","clear","safeSlideIndex"],"mappings":";;;;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,KAAK,QAAQ,qBAAqB;AAC3C,SAASC,UAAU,QAAQ,yBAAyB;AACpD,SAASC,WAAW,QAAQ,6BAA6B;AAQzD;;CAEC,GACD,OAAO,IAAMC,UAAU;0CACrBC,mBAAAA,0DAAoB,8BACpBC,kBAAAA,kCACAC,SAAAA,sCAAU,oBACVC,kBAAAA,UACAC,iBAAAA,SACGC;QALHL;QACAC;QACAC;QACAC;QACAC;;IAGA,IAAyCT,mCAAAA,MAAMW,QAAQ,CAACN,wBAAjDO,kBAAkCZ,oBAAjBa,gBAAiBb;IACzC,IAAMc,eAAe,OAAOJ,MAAMK,UAAU,KAAK;QACfL;IAAlC,IAAMK,aAAaD,eAAeJ,CAAAA,oBAAAA,MAAMK,UAAU,cAAhBL,+BAAAA,oBAAoB,IAAIE;IAC1D,IAAMI,cAAc,CAACF,gBAAgBG,QAAQT;IAC7C,IAAMU,SAASlB,MAAMmB,OAAO,CAC1B;eAAMnB,MAAMoB,QAAQ,CAACC,OAAO,CAACf,UAAUgB,MAAM,CAAC,SAACC;mBAASN,QAAQM;;OAChE;QAACjB;KAAS;IAEZ,IAAMkB,aAAaN,OAAOO,MAAM;IAEhC,IAAMC,eAAyC1B,MAAM2B,WAAW,CAC9D,SAACC;QACC,IAAIA,YAAYb,YAAY;YAC1B;QACF;QACA,CAACD,gBAAgBD,cAAce;QAC/BpB,YAAYA,SAASoB;IACvB,GACA;QAACd;QAAcN;QAAUO;KAAW;IAGtC,IAAMc,WAAW3B,WAAW;eAAMwB,aAAa,AAACX,CAAAA,aAAa,CAAA,IAAKS;OAAajB;IAC/EP,MAAM8B,SAAS,CACb;eAAOvB,UAAUsB,SAASE,GAAG,KAAKF,SAASG,KAAK;OAChD;QAACzB;QAASQ;QAAYc;KAAS;IAGjC,6BAA6B;IAC7B,gEAAgE;IAChE,IAAMI,iBAAiBT,aAAa,IAAIvB,MAAMc,YAAY,GAAGS,aAAa,KAAKT;IAC/E,mCAAmC;IACnCf,MAAM8B,SAAS,CAAC;QACd,IAAItB,YAAYyB,mBAAmBlB,YAAY;YAC7CP,SAASyB;QACX;QACApB,cAAcoB;IAChB,GAAG;QAACzB;QAAUyB;QAAgBlB;KAAW;IAEzC,qBACE,oBAACZ;QACCa,aAAaA;OACTN;QACJD,SAASe,aAAa,KAAKf;QAC3BM,YAAYkB;QACZzB,UAAUkB;QAETR;AAGP,EAAE"}