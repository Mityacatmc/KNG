{"version":3,"sources":["../../../src/lib/date.ts"],"sourcesContent":["import dayjs from 'dayjs';\n\n// Using date-fns-like type for migration\ntype DirtyDate = Date | number;\n\nexport function startOfDay(date: DirtyDate) {\n  return dayjs(date).startOf('day').toDate();\n}\n\nexport function endOfDay(date: DirtyDate) {\n  return dayjs(date).endOf('day').toDate();\n}\n\nexport function startOfWeek(date: DirtyDate, weekStart = 0) {\n  weekStart = weekStart % 7;\n\n  const day = dayjs(date);\n  const weekDay = day.day();\n  const diff = (weekDay < weekStart ? 7 : 0) + weekDay - weekStart;\n\n  return day.date(day.date() - diff).toDate();\n}\n\nexport function endOfWeek(date: DirtyDate, weekStart = 0) {\n  const day = dayjs(startOfWeek(date, weekStart));\n\n  return day.date(day.date() + 6).toDate();\n}\n\nexport function startOfMonth(date: DirtyDate) {\n  return dayjs(date).startOf('month').toDate();\n}\n\nexport function endOfMonth(date: DirtyDate) {\n  return dayjs(date).endOf('month').toDate();\n}\n\nexport function isFirstDayOfMonth(date: DirtyDate) {\n  return dayjs(date).date() === 1;\n}\n\nexport function isLastDayOfMonth(date: DirtyDate) {\n  // isSameDay -- shorter, but not exact with date-fns behavior\n  // return isSameDay(date, dayjs(date).endOf(\"month\"));\n  return dayjs(date).endOf('day').isSame(dayjs(date).endOf('month'));\n}\n\nexport function format(date: DirtyDate, format: string) {\n  return dayjs(date).format(format);\n}\n\nexport function isBefore(date1: DirtyDate, date2: DirtyDate) {\n  // Exactly as date-fns does\n  // dayjs().isBefore() for slightly different approach\n  return dayjs(date1) < dayjs(date2);\n}\n\nexport function isAfter(date1: DirtyDate, date2: DirtyDate) {\n  return dayjs(date1) > dayjs(date2);\n}\n\nexport function isSameDay(date1: DirtyDate, date2: DirtyDate) {\n  return dayjs(date1).isSame(date2, 'day');\n}\n\nexport function isSameMonth(date1: DirtyDate, date2: DirtyDate) {\n  return dayjs(date1).isSame(date2, 'month');\n}\n\nexport function isWithinInterval(date: DirtyDate, start: DirtyDate, end: DirtyDate) {\n  const day = dayjs(date);\n  return day >= dayjs(start) && day <= dayjs(end);\n}\n\nexport function setMinutes(date: DirtyDate, minute: number) {\n  return dayjs(date).set('minute', minute).toDate();\n}\n\nexport function setHours(date: DirtyDate, hour: number) {\n  return dayjs(date).set('hour', hour).toDate();\n}\n\nexport function setMonth(date: DirtyDate, month: number) {\n  return dayjs(date).set('month', month).toDate();\n}\n\nexport function setYear(date: DirtyDate, year: number) {\n  return dayjs(date).set('year', year).toDate();\n}\n\nexport function addDays(date: DirtyDate, day: number) {\n  return dayjs(date).add(day, 'day').toDate();\n}\n\nexport function subDays(date: DirtyDate, day: number) {\n  return dayjs(date).subtract(day, 'day').toDate();\n}\n\nexport function addWeeks(date: DirtyDate, week: number) {\n  return dayjs(date).add(week, 'week').toDate();\n}\n\nexport function subWeeks(date: DirtyDate, week: number) {\n  return dayjs(date).subtract(week, 'week').toDate();\n}\n\nexport function addMonths(date: DirtyDate, month: number) {\n  return dayjs(date).add(month, 'month').toDate();\n}\n\nexport function subMonths(date: DirtyDate, month: number) {\n  return dayjs(date).subtract(month, 'month').toDate();\n}\n\n// Rip off date-fns\nexport function eachDayOfInterval(start: DirtyDate, end: DirtyDate) {\n  const dates: Date[] = [];\n  const startDate = dayjs(start).toDate();\n  const endDate = dayjs(end).toDate();\n\n  const endTime = endDate.getTime();\n  const currentDate = startDate;\n  currentDate.setHours(0, 0, 0, 0);\n\n  while (currentDate.getTime() <= endTime) {\n    dates.push(new Date(currentDate.getTime()));\n    currentDate.setDate(currentDate.getDate() + 1);\n    currentDate.setHours(0, 0, 0, 0);\n  }\n\n  return dates;\n}\n\nexport function parse(input: string, format: string, referenceDate: Date = new Date()) {\n  const match2 = /^\\d\\d/; // 00 - 99\n  const match4 = /^\\d{4}/; // 0000 - 9999\n\n  const entries: Array<[string, RegExp, (val: string) => [string, number, boolean]]> = [\n    ['YYYY', match4, (val) => ['Y', +val, true]],\n    [\n      'MM',\n      match2,\n      (val) => {\n        const numVal = +val;\n        const okay = numVal > 0 && numVal <= 12;\n\n        return ['M', numVal - 1, okay];\n      },\n    ],\n    ['DD', match2, (val) => ['D', +val, true]],\n    [\n      'HH',\n      match2,\n      (val) => {\n        const numVal = parseInt(val, 10);\n        const okay = numVal >= 0 && numVal < 24;\n\n        return ['h', numVal, okay];\n      },\n    ],\n    [\n      'mm',\n      match2,\n      (val) => {\n        const numVal = parseInt(val, 10);\n        const okay = numVal >= 0 && numVal < 60;\n\n        return ['m', numVal, okay];\n      },\n    ],\n  ];\n\n  const superRegExp = new RegExp(entries.map((item) => item[0]).join('|'), 'g');\n\n  const store: {\n    [key: string]: number;\n  } = {\n    Y: referenceDate.getFullYear(),\n    M: referenceDate.getMonth(),\n    D: referenceDate.getDate(),\n    h: referenceDate.getHours(),\n    m: referenceDate.getMinutes(),\n    s: referenceDate.getSeconds(),\n    ms: referenceDate.getMilliseconds(),\n  };\n\n  let prevInputIndex = 0;\n  let lastNonFormatting = '';\n  let lastFormatIndex = 0;\n  let found = false;\n\n  while (true) {\n    const match = superRegExp.exec(format);\n\n    if (!match) {\n      break;\n    }\n\n    const length = match[0].length;\n    const atIndex = superRegExp.lastIndex - length;\n\n    const item = entries.find((item) => item[0] === match[0])!;\n\n    lastNonFormatting = format.slice(lastFormatIndex, atIndex);\n    lastFormatIndex = superRegExp.lastIndex;\n\n    if (\n      input.slice(prevInputIndex, prevInputIndex + lastNonFormatting.length) !== lastNonFormatting\n    ) {\n      return new Date('');\n    }\n\n    const value = input.slice(prevInputIndex + lastNonFormatting.length).match(item[1]);\n\n    if (!value) {\n      return new Date('');\n    }\n\n    prevInputIndex = prevInputIndex + lastNonFormatting.length + value[0].length;\n\n    const [key, newValue, okay] = item[2](value[0]);\n\n    if (!okay) {\n      return new Date('');\n    }\n\n    store[key] = newValue;\n    found = true;\n  }\n\n  if (!found) {\n    return new Date('');\n  }\n\n  const date = new Date(store.Y, store.M, store.D, store.h, store.m, store.s, store.ms);\n\n  // Since days of months are dynamic, they can't be validated in entries,\n  // so we check it here, in the finalized date\n  if (date.getMonth() !== store.M || date.getDate() !== store.D) {\n    return new Date('');\n  }\n\n  return date;\n}\n\nexport function isMatch(input: string, format: string) {\n  return !isNaN(+parse(input, format));\n}\n\nexport function getMillisecondsToTomorrow(date: DirtyDate) {\n  return dayjs(endOfDay(date)).diff(dayjs(date), 'ms');\n}\n"],"names":["startOfDay","endOfDay","startOfWeek","endOfWeek","startOfMonth","endOfMonth","isFirstDayOfMonth","isLastDayOfMonth","format","isBefore","isAfter","isSameDay","isSameMonth","isWithinInterval","setMinutes","setHours","setMonth","setYear","addDays","subDays","addWeeks","subWeeks","addMonths","subMonths","eachDayOfInterval","parse","isMatch","getMillisecondsToTomorrow","date","dayjs","startOf","toDate","endOf","weekStart","day","weekDay","diff","isSame","date1","date2","start","end","minute","set","hour","month","year","add","subtract","week","dates","startDate","endDate","endTime","getTime","currentDate","push","Date","setDate","getDate","input","match","superRegExp","exec","length","atIndex","lastIndex","item","entries","find","lastNonFormatting","slice","lastFormatIndex","prevInputIndex","value","key","newValue","okay","store","found","referenceDate","match2","match4","val","numVal","parseInt","RegExp","map","join","Y","getFullYear","M","getMonth","D","h","getHours","m","getMinutes","s","getSeconds","ms","getMilliseconds","isNaN"],"mappings":"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"}