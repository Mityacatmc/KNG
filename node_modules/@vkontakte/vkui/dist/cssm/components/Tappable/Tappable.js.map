{"version":3,"sources":["../../../../src/components/Tappable/Tappable.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport mitt from 'mitt';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAdaptivityHasHover } from '../../hooks/useAdaptivityHasHover';\nimport { useAdaptivityHasPointer } from '../../hooks/useAdaptivityHasPointer';\nimport { useBooleanState } from '../../hooks/useBooleanState';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useFocusVisible } from '../../hooks/useFocusVisible';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { shouldTriggerClickOnEnterOrSpace } from '../../lib/accessibility';\nimport { SizeType } from '../../lib/adaptivity';\nimport { callMultiple } from '../../lib/callMultiple';\nimport { getOffsetRect } from '../../lib/offset';\nimport { Platform } from '../../lib/platform';\nimport { coordX, coordY } from '../../lib/touch';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport {\n  AnchorHTMLAttributesOnly,\n  HasChildren,\n  HasComponent,\n  HasRootRef,\n  LiteralUnion,\n} from '../../types';\nimport { FocusVisible, FocusVisibleMode } from '../FocusVisible/FocusVisible';\nimport { Touch, TouchEvent, TouchProps } from '../Touch/Touch';\nimport TouchRootContext from '../Touch/TouchContext';\nimport styles from './Tappable.module.css';\n\nconst sizeXClassNames = {\n  none: styles['Tappable--sizeX-none'],\n  compact: styles['Tappable--sizeX-compact'],\n};\n\nconst stylesHoverMode = {\n  background: styles['Tappable--hover-background'],\n  opacity: styles['Tappable--hover-opacity'],\n};\n\nconst stylesActiveMode = {\n  background: styles['Tappable--active-background'],\n  opacity: styles['Tappable--active-opacity'],\n};\n\ntype StateMode = 'opacity' | 'background';\n\nconst WAVE_LIVE = 225;\n\nexport type TappableElementProps = Omit<\n  React.AllHTMLAttributes<HTMLElement>,\n  | 'onTouchStart'\n  | 'onTouchMove'\n  | 'onTouchEnd'\n  | 'onTouchCancel'\n  | 'onMouseDown'\n  | 'onMouseMove'\n  | 'onMouseUp'\n  | 'onMouseLeave'\n> &\n  AnchorHTMLAttributesOnly; // В AllHTMLAttributes не хватает типов для ссылок\n\nexport interface TappableProps\n  extends TappableElementProps,\n    HasRootRef<HTMLElement>,\n    HasComponent,\n    HasChildren,\n    Pick<TouchProps, 'onStart' | 'onEnd' | 'onMove'> {\n  /**\n   * Длительность показа active-состояния\n   */\n  activeEffectDelay?: number;\n  stopPropagation?: boolean;\n  /**\n   * Указывает, должен ли компонент реагировать на hover-состояние\n   */\n  hasHover?: boolean;\n  /**\n   * Позволяет управлять hovered-состоянием извне\n   */\n  hovered?: boolean;\n  /**\n   * Указывает, должен ли компонент реагировать на active-состояние\n   */\n  hasActive?: boolean;\n  /**\n   * Стиль подсветки active-состояния. Если передать произвольную строку, она добавится как css-класс во время active\n   */\n  activeMode?: LiteralUnion<StateMode, string>;\n  /**\n   * Стиль подсветки hover-состояния. Если передать произвольную строку, она добавится как css-класс во время hover\n   */\n  hoverMode?: LiteralUnion<StateMode, string>;\n  /**\n   * Стиль аутлайна focus visible. Если передать произвольную строку, она добавится как css-класс во время focus-visible\n   */\n  focusVisibleMode?: LiteralUnion<FocusVisibleMode, string>;\n  onEnter?(outputEvent: MouseEvent): void;\n  onLeave?(outputEvent: MouseEvent): void;\n  /**\n   * Задает border-radius элементу\n   * В режиме `auto` на маленьких экранах `border-radius: 0`, иначе определяется токеном `--vkui--size_border_radius--regular`\n   */\n  borderRadiusMode?: 'auto' | 'inherit';\n}\n\ninterface Wave {\n  x: number;\n  y: number;\n  id: number;\n}\n\nexport interface RootComponentProps extends TouchProps {\n  ref?: React.Ref<HTMLElement>;\n}\n\nexport const ACTIVE_DELAY = 70;\nexport const ACTIVE_EFFECT_DELAY = 600;\n\nconst activeBus = mitt<{ active: string }>();\nconst TapState = { none: 0, pending: 1, active: 2, exiting: 3 } as const;\n\ntype TappableContextInterface = { onHoverChange: (s: boolean) => void };\nconst TappableContext = React.createContext<TappableContextInterface>({\n  onHoverChange: noop,\n});\n\nfunction isPresetStateMode(stateMode: LiteralUnion<StateMode, string>): stateMode is StateMode {\n  switch (stateMode) {\n    case 'opacity':\n    case 'background':\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction useActivity(hasActive: boolean, stopDelay: number) {\n  const id = React.useMemo(() => Math.round(Math.random() * 1e8).toString(16), []);\n\n  const [activity, setActivity] = React.useState<(typeof TapState)[keyof typeof TapState]>(\n    TapState.none,\n  );\n  const _stop = () => setActivity(TapState.none);\n  const start = () => hasActive && setActivity(TapState.active);\n  const delayStart = () => {\n    hasActive && setActivity(TapState.pending);\n  };\n\n  const activeTimeout = useTimeout(start, ACTIVE_DELAY);\n  const stopTimeout = useTimeout(_stop, stopDelay);\n\n  useIsomorphicLayoutEffect(() => {\n    if (activity === TapState.pending) {\n      activeTimeout.set();\n      return activeTimeout.clear;\n    }\n    if (activity === TapState.exiting) {\n      return stopTimeout.clear;\n    }\n    if (activity === TapState.active) {\n      activeBus.emit('active', id);\n    }\n    return noop;\n  }, [activity]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (activity === TapState.none) {\n      return noop;\n    }\n    const onActiveChange = (activeId: string) => {\n      activeId !== id && _stop();\n    };\n    activeBus.on('active', onActiveChange);\n    return () => activeBus.off('active', onActiveChange);\n  }, [activity === TapState.none]);\n\n  useIsomorphicLayoutEffect(() => {\n    !hasActive && _stop();\n  }, [hasActive]);\n\n  const stop = (delay?: number) => {\n    if (delay) {\n      setActivity(TapState.exiting);\n      return stopTimeout.set(delay);\n    }\n    _stop();\n  };\n\n  return [activity, { delayStart, start, stop }] as const;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Tappable\n */\nexport const Tappable = ({\n  children,\n  Component,\n  onClick,\n  onKeyDown: _onKeyDown,\n  activeEffectDelay = ACTIVE_EFFECT_DELAY,\n  stopPropagation = false,\n  getRootRef,\n  hasHover: _hasHover = true,\n  hoverMode = 'background',\n  hasActive: _hasActive = true,\n  activeMode = 'background',\n  focusVisibleMode = 'inside',\n  onEnter,\n  onLeave,\n  className,\n  hovered: hoveredProp,\n  borderRadiusMode = 'auto',\n  ...props\n}: TappableProps) => {\n  Component = Component || ((props.href ? 'a' : 'div') as React.ElementType);\n\n  const { onHoverChange } = React.useContext(TappableContext);\n  const insideTouchRoot = React.useContext(TouchRootContext);\n  const platform = usePlatform();\n  const { focusVisible, onBlur, onFocus } = useFocusVisible();\n  const { sizeX = 'none' } = useAdaptivity();\n  const hasPointerContext = useAdaptivityHasPointer();\n  const hasHoverContext = useAdaptivityHasHover();\n\n  const [clicks, setClicks] = React.useState<Wave[]>([]);\n  const [childHover, setChildHover] = React.useState(false);\n  const {\n    value: _hovered,\n    setTrue: setHoveredTrue,\n    setFalse: setHoveredFalse,\n  } = useBooleanState(false);\n\n  const hovered = (_hovered || hoveredProp) && !props.disabled;\n  const hasActive = _hasActive && !childHover && !props.disabled;\n  const hasHover = hasHoverContext && _hasHover && !childHover;\n  const isCustomElement =\n    Component !== 'a' && Component !== 'button' && Component !== 'label' && !props.contentEditable;\n  const isPresetHoverMode = isPresetStateMode(hoverMode);\n  const isPresetActiveMode = isPresetStateMode(activeMode);\n  const isPresetFocusVisibleMode = ['inside', 'outside'].includes(focusVisibleMode);\n\n  const [activity, { start, stop, delayStart }] = useActivity(hasActive, activeEffectDelay);\n  const active = activity === TapState.active || activity === TapState.exiting;\n\n  const containerRef = useExternRef(getRootRef);\n\n  // hover propagation\n  const childContext = React.useRef({ onHoverChange: setChildHover }).current;\n  useIsomorphicLayoutEffect(() => {\n    if (!hovered) {\n      return noop;\n    }\n    onHoverChange(true);\n    return () => onHoverChange(false);\n  }, [hovered]);\n\n  /*\n   * [a11y]\n   * Обрабатывает событие onkeydown\n   * для кастомных доступных элементов:\n   * - role=\"link\" (активация по Enter)\n   * - role=\"button\" (активация по Space и Enter)\n   */\n  function onKeyDown(e: React.KeyboardEvent<HTMLElement>) {\n    if (isCustomElement && shouldTriggerClickOnEnterOrSpace(e)) {\n      e.preventDefault();\n      containerRef.current?.click();\n    }\n  }\n\n  const needWaves =\n    platform === Platform.ANDROID && !hasPointerContext && hasActive && activeMode === 'background';\n\n  const clearClicks = useTimeout(() => setClicks([]), WAVE_LIVE);\n\n  function addClick(x: number, y: number) {\n    const dateNow = Date.now();\n    const filteredClicks = clicks.filter((click) => click.id + WAVE_LIVE > dateNow);\n\n    setClicks([...filteredClicks, { x, y, id: dateNow }]);\n    clearClicks.set();\n  }\n\n  function onStart({ originalEvent }: TouchEvent) {\n    if (hasActive) {\n      if (originalEvent.touches && originalEvent.touches.length > 1) {\n        // r сожалению я так и не понял, что это делает и можно ли упихнуть его в Touch\n        return stop();\n      }\n\n      if (needWaves) {\n        const { top, left } = getOffsetRect(containerRef.current);\n        const x = coordX(originalEvent) - (left ?? 0);\n        const y = coordY(originalEvent) - (top ?? 0);\n        addClick(x, y);\n      }\n\n      delayStart();\n    }\n  }\n\n  function onMove({ isSlide }: TouchEvent) {\n    if (isSlide) {\n      stop();\n    }\n  }\n\n  function onEnd({ duration }: TouchEvent) {\n    if (activity === TapState.none) {\n      return;\n    }\n    if (activity === TapState.pending) {\n      // активировать при коротком тапе\n      start();\n    }\n\n    // отключить без задержки при длинном тапе\n    const activeDuration = duration - ACTIVE_DELAY;\n    stop(activeDuration >= 100 ? 0 : activeEffectDelay - activeDuration);\n  }\n\n  const classes = classNames(\n    className,\n    styles['Tappable'],\n    'vkuiInternalTappable',\n    platform === Platform.IOS && styles['Tappable--ios'],\n    sizeX !== SizeType.REGULAR && sizeXClassNames[sizeX],\n    hasHover && styles['Tappable--hasHover'],\n    hasActive && styles['Tappable--hasActive'],\n    hasHover && hovered && !isPresetHoverMode && hoverMode,\n    hasActive && active && !isPresetActiveMode && activeMode,\n    focusVisible && !isPresetFocusVisibleMode && focusVisibleMode,\n    hasHover && hovered && isPresetHoverMode && stylesHoverMode[hoverMode],\n    hasActive && active && isPresetActiveMode && stylesActiveMode[activeMode],\n    focusVisible && styles['Tappable--focus-visible'],\n    borderRadiusMode === 'inherit' && styles['Tappable--borderRadiusInherit'],\n  );\n\n  const handlers: RootComponentProps = {\n    onStart: callMultiple(onStart, props.onStart),\n    onMove: callMultiple(onMove, props.onMove),\n    onEnd: callMultiple(onEnd, props.onEnd),\n    onClick,\n    onKeyDown: callMultiple(onKeyDown, _onKeyDown),\n  };\n  const role = props.href ? 'link' : 'button';\n\n  return (\n    <Touch\n      onEnter={callMultiple(setHoveredTrue, onEnter)}\n      onLeave={callMultiple(setHoveredFalse, onLeave)}\n      type={Component === 'button' ? 'button' : undefined}\n      tabIndex={isCustomElement && !props.disabled ? 0 : undefined}\n      role={isCustomElement ? role : undefined}\n      aria-disabled={isCustomElement ? props.disabled : undefined}\n      stopPropagation={stopPropagation && !insideTouchRoot && !props.disabled}\n      {...props}\n      slideThreshold={20}\n      usePointerHover\n      className={classes}\n      Component={Component}\n      getRootRef={containerRef}\n      onBlur={callMultiple(onBlur, props.onBlur)}\n      onFocus={callMultiple(onFocus, props.onFocus)}\n      {...(props.disabled ? {} : handlers)}\n    >\n      <TappableContext.Provider value={childContext}>{children}</TappableContext.Provider>\n      {needWaves && (\n        <span aria-hidden className={styles.Tappable__waves}>\n          {clicks.map((wave) => (\n            <span\n              key={wave.id}\n              className={styles.Tappable__wave}\n              style={{ top: wave.y, left: wave.x }}\n            />\n          ))}\n        </span>\n      )}\n      {((hasHover && hoverMode === 'background') || (hasActive && activeMode === 'background')) && (\n        <span aria-hidden className={styles.Tappable__stateLayer} />\n      )}\n      {!props.disabled && isPresetFocusVisibleMode && (\n        <FocusVisible visible={focusVisible} mode={focusVisibleMode as FocusVisibleMode} />\n      )}\n    </Touch>\n  );\n};\n"],"names":["React","classNames","noop","mitt","useAdaptivity","useAdaptivityHasHover","useAdaptivityHasPointer","useBooleanState","useExternRef","useFocusVisible","usePlatform","useTimeout","shouldTriggerClickOnEnterOrSpace","SizeType","callMultiple","getOffsetRect","Platform","coordX","coordY","useIsomorphicLayoutEffect","FocusVisible","Touch","TouchRootContext","styles","sizeXClassNames","none","compact","stylesHoverMode","background","opacity","stylesActiveMode","WAVE_LIVE","ACTIVE_DELAY","ACTIVE_EFFECT_DELAY","activeBus","TapState","pending","active","exiting","TappableContext","createContext","onHoverChange","isPresetStateMode","stateMode","useActivity","hasActive","stopDelay","id","useMemo","Math","round","random","toString","activity","setActivity","useState","_stop","start","delayStart","activeTimeout","stopTimeout","set","clear","emit","onActiveChange","activeId","on","off","stop","delay","Tappable","children","Component","onClick","onKeyDown","_onKeyDown","activeEffectDelay","stopPropagation","getRootRef","hasHover","_hasHover","hoverMode","_hasActive","activeMode","focusVisibleMode","onEnter","onLeave","className","hovered","hoveredProp","borderRadiusMode","props","href","useContext","insideTouchRoot","platform","focusVisible","onBlur","onFocus","sizeX","hasPointerContext","hasHoverContext","clicks","setClicks","childHover","setChildHover","value","_hovered","setTrue","setHoveredTrue","setFalse","setHoveredFalse","disabled","isCustomElement","contentEditable","isPresetHoverMode","isPresetActiveMode","isPresetFocusVisibleMode","includes","containerRef","childContext","useRef","current","e","preventDefault","click","needWaves","ANDROID","clearClicks","addClick","x","y","dateNow","Date","now","filteredClicks","filter","onStart","originalEvent","touches","length","top","left","onMove","isSlide","onEnd","duration","activeDuration","classes","IOS","REGULAR","handlers","role","type","undefined","tabIndex","aria-disabled","slideThreshold","usePointerHover","Provider","span","aria-hidden","Tappable__waves","map","wave","key","Tappable__wave","style","Tappable__stateLayer","visible","mode"],"mappings":"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"}